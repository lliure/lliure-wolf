<?php/**** Newsmade | lliure 5.x - 6.x** @Versуo 4* @Pacote lliure* @Entre em contato com o desenvolvedor <lliure@lliure.com.br> http://www.lliure.com.br/* @Licenчa http://opensource.org/licenses/gpl-license.php GNU Public License**/function url_disponivel($url, $id, $num = null){	return url_check($url, $id, 'newsmade_postagens', 'url', $num);}function url_check($url, $id, $table, $column, $num = null){	if(!empty($num)){		$url_new = $url.'-'.$num;		$num++;	} else {		$url_new = $url;		$num = 2;	}		$consulta = mysql_query('select * from '.PREFIXO.$table.' where '.$column.' = "'.$url_new.'" and id != "'.$id.'" limit 1');		if(mysql_num_rows($consulta) > 0)		return url_disponivel($url, $id, $num);	else		return $url_new;}switch(isset($_GET['ac'])? $_GET['ac'] : 'default' ){case 'gb_add':			if($erro = jf_insert(PREFIXO . 'newsmade_blogs', array('nome' => 'Novo blog')))		echo $erro;	header('location: '.$_ll['app']['home'].'&p=g_blogs');	break;	/*******************************	BLOG */case 'b_criar':	$dados['data'] = time();	$dados['data_up'] = $dados['data'];	$dados['user'] = $_ll['user']['id'];	if($_GET['blog'] != 'default')		$dados['blog'] = $_GET['blog'];		echo jf_insert(PREFIXO.'newsmade_postagens', $dados);		header('location: '.$_ll['app']['home'].'&p=blog&ac=editar&id='.$jf_ultimo_id.'&blog='.$_GET['blog']);			break;	case 'b_del':	jf_delete(PREFIXO.'newsmade_postagens', array('id' => $_GET['post']));		$_SESSION['aviso'] = array('Postagem excluida com sucesso!', 1);				header('location: '.$_ll['app']['home'].'&p=blog&blog='.$_GET['blog']);	break;case 'b_alterar':	$id = $_GET['id'];	$_POST['data_up'] = time();		if(empty($_POST['data']))		unset($_POST['data']);	else		$_POST['data'] = jf_dunix($_POST['data']);		switch (jf_form_actions('salvar', 'public')){		case 'salvar':						break;		case 'public':			$_POST['publicar'] = 1;							break;			}	$retorno = $_ll['app']['home'].'&p=blog&ac=editar&id='.$id;	jf_update(PREFIXO.'newsmade_postagens', $_POST, array('id' => $id));	$_SESSION['aviso'] = array('Alteraчуo realizada com sucesso!', 1);	header('location: '.$retorno);	break;	case 'b_gera_url':	$consulta = 'select * from '.PREFIXO.'newsmade_postagens where id ="'.jf_anti_injection($_GET['id']).'"';		$dados = mysql_fetch_assoc(mysql_query($consulta));		if($dados['publicar'] == 1)		break;			$_POST['titulo'] = trim(jf_iconv2($_POST['titulo']));		$gravar['url'] = url_disponivel(jf_urlformat(str_replace('/', ' ', $_POST['titulo'])), $dados['id']);	if(empty($dados['titulo'])){		$gravar['titulo'] = $_POST['titulo'];				jf_update(PREFIXO.'newsmade_postagens', $gravar, array('id' => $_GET['id']));	}		echo $gravar['url'];			break;	/*******************************	GERENCIAMENTO DE BLOGS 	*/	case 'gb_edit':	$id = $_GET['id'];		$_POST['url'] = url_check(jf_urlformat(str_replace('/', ' ', $_POST['nome'])), 'newsmade_blogs', 'url', $id);		jf_update(PREFIXO.'newsmade_blogs', $_POST, array('id' => $id));			header('location: '.$_ll['app']['home'].'&p=g_blogs&ac=edit&id='.$id);	break;	/*******************************	MIDIAS 					*/	case 'md_novoAlbum':	$nome = "Novo album";	$executa = "INSERT INTO ".PREFIXO."newsmade_albuns (nome, data) values ('".$nome."', '".time()."')";	$query = mysql_query($executa);	break;	case 'md_salvarAlbum':	$id = $_GET['album'];		$retorno = jf_form_actions('salvar', 'salvar-edit');		jf_update(PREFIXO.'newsmade_albuns', $_POST, array('id' => $id));		$_SESSION['aviso'] = array('Album alterado com sucesso!', 1);			switch ($retorno){	case 'salvar':		$retorno = $_ll['app']['home'].'&p=midia';		break;			case 'salvar-edit':		$retorno = $_ll['app']['home'].'&p=midia&album='.$id;		break;			}		header('location: '.$retorno);	break;	case 'alt_modo':	jf_update(PREFIXO.'newsmade_postagens', array('modo' => $_GET['modo']), array('id' => $_GET['id']));	header('location: '.$_ll['app']['home'].'&p=blog&ac=editar&id='.$_GET['id']);	break;}?>