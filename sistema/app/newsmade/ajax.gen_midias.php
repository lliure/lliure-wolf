<?php/**** Newsmade | lliure 5.x - 6.x** @Versão 4* @Pacote lliure* @Entre em contato com o desenvolvedor <lliure@lliure.com.br> http://www.lliure.com.br/* @Licença http://opensource.org/licenses/gpl-license.php GNU Public License**/$urlPadrao = $_ll['app']['onclient'].'&p=ajax.gen_midias';function abas(){	global $urlPadrao;		echo '<div class="abas">'			.'<a href="'.$urlPadrao.'&notic='.$_GET['notic'].'" class="jfbox '.(!isset($_GET['ac']) ? 'ativo' : '' ).'">Album</a>'			.'<a href="'.$urlPadrao.'&ac=midias&notic='.$_GET['notic'].'" class="jfbox '.(isset($_GET['ac']) ? 'ativo' : '' ).'" >Mídias</a>'		.'</div>';	}if(!isset($_GET['ac'])){	$sql = mysql_query('select * from '.PREFIXO.'newsmade_postagens_albuns where idPostagem = "'.$_GET['notic'].'"');	if(mysql_num_rows($sql) == 0)		$_GET['ac'] = 'midias';}switch(isset($_GET['ac']) ? $_GET['ac'] : 'home'){	case 'home':			abas();		$dados = mysql_fetch_assoc(mysql_query('select * from '.PREFIXO.'newsmade_postagens_albuns where idPostagem = "'.$_GET['notic'].'"'));							$consulta = "select * from ".PREFIXO."newsmade_albuns where id =".$dados['idAlbum'];		$dados = mysql_fetch_assoc(mysql_query($consulta));				$galeriaAPI['tabela'] = "newsmade_albuns";						$galeriaAPI['ligacaoCampo'] = 'album';		$galeriaAPI['ligacaoId'] = $dados['id'];				$galeriaAPI['dir'] = "../uploads/newsmade";		$galeriaAPI['ordem'] = true;				$galeriaAPI['capaCampo'] = "capa";		$galeriaAPI['capaFoto'] = (!empty($dados['capa'])?$dados['capa']:"");				require_once('api/fotos/index.php');				?>		<script type="text/javascript">			<?php			if(isset($_GET['save']))				echo 'jfAlert("Alteração realizada com sucesso!");'			?>		</script>		<?php			break;			case 'midias':		$sql = mysql_query('select * from '.PREFIXO.'newsmade_postagens_albuns where idPostagem = "'.$_GET['notic'].'"');		$albuns = array();		while($dados = mysql_fetch_assoc($sql)){			$albuns[] = $dados['idAlbum'];		}		abas();		?>				<form method="post" action="<?php echo $urlPadrao.'&ac=grava&notic='.$_GET['notic']; ?>"  class="jfbox">			<input type="hidden" name="post" value="<?php echo $_GET['notic']?>">						<div class="albuns">				<div class="album novo">										<div class="img">						<a href="<?php echo $urlPadrao.'&ac=criar_album&notic='.$_GET['notic']; ?>" class="jfbox">Criar album</a>					</div>				</div>								<?php				$sql = mysql_query('select a.*, b.foto 						from '.PREFIXO.'newsmade_albuns as a												inner join '.PREFIXO.'newsmade_albuns_fotos as b						on b.id = a.capa												order by id desc						') or die(mysql_error());										while($dados = mysql_fetch_assoc($sql)){					$checked = in_array($dados['id'], $albuns);					?>					<div class="album <?php echo $checked ? 'checked' : ''?>">						<div class="dados">							<span class="input">								<input type="radio" name="albuns[]" value="<?php echo $dados['id']?>" <?php echo $checked ? 'checked' : ''?> />							</span>							<div>								<span class="titulo"><?php echo $dados['nome']?></span>														<span class="data"><?php echo date('d/m/Y', $dados['data'])?></span>							</div>						</div>												<div class="img">							<img src="../uploads/thumb.php?i=newsmade/<?php echo $dados['foto']?>:70:70:c"/>						</div>					</div>					<?php				}				?>			</div>						<div class="both"></div>			<span class="botao"><button type="submit">Salvar</button></span>		</form>		<script type="text/javascript">			$('.albuns .album .img').click(function(){				var div = $(this).closest('.album')				div.find('.dados input').click();				$('.album').removeClass('checked');				div.addClass('checked');			});			</script>		<?php		break;			case 'criar_album':		$dados = array(			'data' => time(),			'nome' => 'Por sistema'			);				jf_insert(PREFIXO.'newsmade_albuns', $dados);				$sql = mysql_query('select * from '.PREFIXO.'newsmade_postagens_albuns where idPostagem = "'.$_GET['notic'].'"');				if(mysql_num_rows($sql) > 0){			jf_update(PREFIXO.'newsmade_postagens_albuns', array('idAlbum' => $jf_ultimo_id), array('idPostagem' => $_GET['notic']));		} else {			jf_insert(PREFIXO.'newsmade_postagens_albuns', array('idPostagem' => $_GET['notic'], 'idAlbum' => $jf_ultimo_id));		}				header('location: '.$urlPadrao.'&save=1&notic='.$_GET['notic']);		break;					case 'grava':				!isset($_POST['albuns']) ? $_POST['albuns'] = array() :'';		$sql = mysql_query('select * from '.PREFIXO.'newsmade_postagens_albuns where idPostagem = "'.$_GET['notic'].'"');				while($dados = mysql_fetch_assoc($sql))			if(in_array($dados['idAlbum'], $_POST['albuns']))				unset($_POST['albuns'][array_search($dados['idAlbum'], $_POST['albuns'])]);			elseif(!in_array($dados['idAlbum'], $_POST['albuns']))				jf_delete(''.PREFIXO.'newsmade_postagens_albuns', array('id' => $dados['id']));				foreach($_POST['albuns'] as $chave => $valor)			jf_insert(''.PREFIXO.'newsmade_postagens_albuns', array('idPostagem' => $_GET['notic'], 'idAlbum' => $valor));				header('location: '.$urlPadrao.'&save=1&notic='.$_GET['notic']);		break;}?>